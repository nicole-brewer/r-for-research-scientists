<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Unit Testing | R for Research Scientists</title>
  <meta name="description" content="A book for researchers who contribute code to R projects, but are not package administrators." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Unit Testing | R for Research Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A book for researchers who contribute code to R projects, but are not package administrators." />
  <meta name="github-repo" content="brewer36/r-for-research-scientists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Unit Testing | R for Research Scientists" />
  
  <meta name="twitter:description" content="A book for researchers who contribute code to R projects, but are not package administrators." />
  

<meta name="author" content="Nicole Brewer" />


<meta name="date" content="2020-02-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pack.html"/>
<link rel="next" href="doc.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R for Research Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preamble</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-is-this-book-for"><i class="fa fa-check"></i>Who is this book for?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-you-wont-learn."><i class="fa fa-check"></i>What you won’t learn.</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-will-you-learn"><i class="fa fa-check"></i>What will you learn?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#why-this-worth-your-precious-time"><i class="fa fa-check"></i>Why this worth your precious time?</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="git.html"><a href="git.html"><i class="fa fa-check"></i><b>1</b> Git and Github</a>
<ul>
<li class="chapter" data-level="1.1" data-path="git.html"><a href="git.html#git-in-rstudio"><i class="fa fa-check"></i><b>1.1</b> Git in RStudio</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="git.html"><a href="git.html#setting-up-remotes-for-the-first-time"><i class="fa fa-check"></i><b>1.1.1</b> Setting Up Remotes for the First Time</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="git.html"><a href="git.html#git-workflow-from-a-fork"><i class="fa fa-check"></i><b>1.2</b> Git Workflow from a Fork</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="git.html"><a href="git.html#merge-upstream-changes-into-your-own-master-branch"><i class="fa fa-check"></i><b>1.2.1</b> Merge upstream changes into your own master branch</a></li>
<li class="chapter" data-level="1.2.2" data-path="git.html"><a href="git.html#create-a-branch-to-work-on-a-new-feature-or-bugfix"><i class="fa fa-check"></i><b>1.2.2</b> Create a branch to work on a new feature or bugfix</a></li>
<li class="chapter" data-level="1.2.3" data-path="git.html"><a href="git.html#repeatedAmend"><i class="fa fa-check"></i><b>1.2.3</b> Use the Repeated Amend strategy to develop your feature branch</a></li>
<li class="chapter" data-level="1.2.4" data-path="git.html"><a href="git.html#push-changes-to-github-and-create-pull-request"><i class="fa fa-check"></i><b>1.2.4</b> Push changes to GitHub and create pull request</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="pack.html"><a href="pack.html"><i class="fa fa-check"></i><b>2</b> Packages</a>
<ul>
<li class="chapter" data-level="2.1" data-path="pack.html"><a href="pack.html#install-development-tools"><i class="fa fa-check"></i><b>2.1</b> Install Development Tools</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="pack.html"><a href="pack.html#mac-xcode"><i class="fa fa-check"></i><b>2.1.1</b> Mac: XCode</a></li>
<li class="chapter" data-level="2.1.2" data-path="pack.html"><a href="pack.html#windows-rtools"><i class="fa fa-check"></i><b>2.1.2</b> Windows: Rtools</a></li>
<li class="chapter" data-level="2.1.3" data-path="pack.html"><a href="pack.html#linux-r-development-tools-package"><i class="fa fa-check"></i><b>2.1.3</b> Linux: R development tools package</a></li>
<li class="chapter" data-level="2.1.4" data-path="pack.html"><a href="pack.html#verify-success-in-rstudio-console"><i class="fa fa-check"></i><b>2.1.4</b> Verify Success in RStudio Console</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="pack.html"><a href="pack.html#rules-and-best-practices"><i class="fa fa-check"></i><b>2.2</b> Rules and Best Practices:</a></li>
<li class="chapter" data-level="2.3" data-path="pack.html"><a href="pack.html#building-the-package"><i class="fa fa-check"></i><b>2.3</b> Building the package</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="pack.html"><a href="pack.html#when"><i class="fa fa-check"></i><b>2.3.1</b> When?</a></li>
<li class="chapter" data-level="2.3.2" data-path="pack.html"><a href="pack.html#clean"><i class="fa fa-check"></i><b>2.3.2</b> Clean</a></li>
<li class="chapter" data-level="2.3.3" data-path="pack.html"><a href="pack.html#build"><i class="fa fa-check"></i><b>2.3.3</b> Build</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="test.html"><a href="test.html"><i class="fa fa-check"></i><b>3</b> Unit Testing</a>
<ul>
<li class="chapter" data-level="3.1" data-path="test.html"><a href="test.html#test-scripts"><i class="fa fa-check"></i><b>3.1</b> Test Scripts</a></li>
<li class="chapter" data-level="3.2" data-path="test.html"><a href="test.html#an-example-test"><i class="fa fa-check"></i><b>3.2</b> An Example Test</a></li>
<li class="chapter" data-level="3.3" data-path="test.html"><a href="test.html#expectations"><i class="fa fa-check"></i><b>3.3</b> Expectations</a></li>
<li class="chapter" data-level="3.4" data-path="test.html"><a href="test.html#testing-workflow"><i class="fa fa-check"></i><b>3.4</b> Testing Workflow</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="doc.html"><a href="doc.html"><i class="fa fa-check"></i><b>4</b> Documentation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="doc.html"><a href="doc.html#how-roxygen-works"><i class="fa fa-check"></i><b>4.1</b> How roxygen Works</a></li>
<li class="chapter" data-level="4.2" data-path="doc.html"><a href="doc.html#r-documentation-rd-format"><i class="fa fa-check"></i><b>4.2</b> R Documentation (Rd) Format</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="doc.html"><a href="doc.html#generate-roxygen-skeleton"><i class="fa fa-check"></i><b>4.2.1</b> Generate Roxygen Skeleton</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="doc.html"><a href="doc.html#exports"><i class="fa fa-check"></i><b>4.3</b> Exports</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html"><i class="fa fa-check"></i><b>5</b> Putting It All Together</a>
<ul>
<li class="chapter" data-level="5.1" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#the-workflow"><i class="fa fa-check"></i><b>5.1</b> The Workflow</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#before-we-start-coding-lets-make-sure-were-up-to-date."><i class="fa fa-check"></i><b>5.1.1</b> Before we start coding, let’s make sure were up to date.</a></li>
<li class="chapter" data-level="5.1.2" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#create-a-branch-to-work-on-a-new-feature-or-bugfix-1"><i class="fa fa-check"></i><b>5.1.2</b> Create a branch to work on a new feature or bugfix</a></li>
<li class="chapter" data-level="5.1.3" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#load-the-devtools-library"><i class="fa fa-check"></i><b>5.1.3</b> Load the <code>devtools</code> library</a></li>
<li class="chapter" data-level="5.1.4" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#abide-by-the-repeaded-amend-strategy"><i class="fa fa-check"></i><b>5.1.4</b> Abide by the <span>Repeaded Amend</span> strategy</a></li>
<li class="chapter" data-level="5.1.5" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#integrate-changes-with-the-package"><i class="fa fa-check"></i><b>5.1.5</b> Integrate Changes with the Package</a></li>
<li class="chapter" data-level="5.1.6" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#incorperate-upstream-changes-1"><i class="fa fa-check"></i><b>5.1.6</b> Incorperate Upstream Changes</a></li>
<li class="chapter" data-level="5.1.7" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#congratulations"><i class="fa fa-check"></i><b>5.1.7</b> Congratulations!</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="putting-it-all-together.html"><a href="putting-it-all-together.html#contending-with-upstream-changes"><i class="fa fa-check"></i><b>5.2</b> Contending with Upstream Changes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Research Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="test" class="section level1">
<h1 number="3"><span class="header-section-number">3</span> Unit Testing</h1>
<p>Likely as not, you have already written scripts that demonstrate that your script runs and produces a desired results. Unit testing, via the <strong>testthat</strong> package <span class="citation">(Wickham <a href="references.html#ref-testthat" role="doc-biblioref">2011</a>)</span>, formalizes this process and automates many of these scripts at once to make running a comprehensive test set easy to do. Read up about <a href="https://r-pkgs.org/tests.html">testing</a> and <a href="https://r-pkgs.org/r-cmd-check.html">automated checking</a></p>
<div id="test-scripts" class="section level2">
<h2 number="3.1"><span class="header-section-number">3.1</span> Test Scripts</h2>
<p>Each time you write a user-facing or non-trivial function, you should write a test script that verifies that the function returns the result you expected in all individual cases. These test files live in <code>tests/testthat/</code>. The file name must start with “test” and it should indicate which function or functionality is being tested.</p>
</div>
<div id="an-example-test" class="section level2">
<h2 number="3.2"><span class="header-section-number">3.2</span> An Example Test</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="test.html#cb7-1"></a><span class="kw">test_that</span>(<span class="st">&quot;multiplication works&quot;</span>, {</span>
<span id="cb7-2"><a href="test.html#cb7-2"></a>  actual =<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span></span>
<span id="cb7-3"><a href="test.html#cb7-3"></a>  expected =<span class="st"> </span><span class="dv">4</span></span>
<span id="cb7-4"><a href="test.html#cb7-4"></a>  <span class="kw">expect_equal</span>(actual, expected)</span>
<span id="cb7-5"><a href="test.html#cb7-5"></a>})</span></code></pre></div>
</div>
<div id="expectations" class="section level2">
<h2 number="3.3"><span class="header-section-number">3.3</span> Expectations</h2>
<p>Expect functions are those at the end of test each test case that allow you to check the output of your function against what you expect. There are many kinds of these functions, the most common being <code>expect_equal()</code>. If need be, there are more complicated ways to express expectation such as <code>expect_lt()</code> that passes when the returned value is less than the specified value, or <code>expect_error()</code> that expects an error to be thrown instead of a return value. A comprehensive list can be found <a href="https://testthat.r-lib.org/reference/index.html">here</a>.</p>
</div>
<div id="testing-workflow" class="section level2">
<h2 number="3.4"><span class="header-section-number">3.4</span> Testing Workflow</h2>
<ol style="list-style-type: decimal">
<li>Create a new functionality.</li>
<li>Write a series of tests in a new file to verify your function behaves the way you <em>expect</em> in every scenario, including edge cases, with parameters like <code>0</code>, <code>null</code>, and minimum or maximum possible input values.</li>
<li>Load the edits you made and test the package with <code>devtools::test()</code>.</li>
<li>Modify your code to fix failing test cases.</li>
<li>Repeat until all tests pass.</li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pack.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="doc.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/r-for-research-scientists/edit/master/03-test.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-for-research-scientists.pdf", "r-for-research-scientists.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
